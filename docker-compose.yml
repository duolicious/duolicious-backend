services:
  postgres:
    build:
      context: .
      dockerfile: postgres.Dockerfile
    ports:
      - "5433:5432"
    environment:
      POSTGRES_PASSWORD: password
      POSTGRES_USER: postgres
      POSTGRES_DB: postgres

  chat:
    build:
      context: .
      dockerfile: chat.Dockerfile
    ports:
      - "5443:5443"
      - "5222:5222"
    environment:
      DUO_API_HOST: http://api:5000

  api:
    build:
      context: .
      dockerfile: api.Dockerfile
    depends_on:
      - postgres
      - chat
    ports:
      - "5000:5000"
    volumes:
      - .:/app:ro
    environment:
      DUO_ENV: dev
      DUO_EMAIL_KEY: ''
      DUO_EMAIL_URL: ''
      DUO_DB_HOST: postgres
      DUO_DB_PORT: 5432
      DUO_DB_NAME: postgres
      DUO_DB_USER: postgres
      DUO_DB_PASS: password
      DUO_CORS_ORIGINS: '*'
      DUO_R2_BUCKET_NAME: ${DUO_R2_BUCKET_NAME}
      DUO_R2_ACCT_ID: ${DUO_R2_ACCT_ID}
      DUO_R2_ACCESS_KEY_ID: ${DUO_R2_ACCESS_KEY_ID}
      DUO_R2_ACCESS_KEY_SECRET: ${DUO_R2_ACCESS_KEY_SECRET}

networks:
  default:
    driver: bridge
